{% extends "base.html" %}
{% load static %}

{% block title %}Inventory Management Dashboard{% endblock %}

{% block head %}
   <style>
    body {
    background-color: #f4f6f9;
    font-family: 'Inter', sans-serif;
    color: #333;
}

.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 30px;
}

.dashboard-header h1 {
    font-size: 2.5em;
    color: #1e1e2d;
}

.chart-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.chart-card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    transition: transform 0.3s ease;
}

.chart-card:hover {
    transform: translateY(-5px);
}

.chart-card h2 {
    font-size: 1.2em;
    color: #5a5a89;
    margin-bottom: 10px;
}

.dashboard-footer {
    text-align: center;
    margin-top: 30px;
    color: #888;
    font-size: 0.9em;
}

   </style>

{% endblock %}

{% block content %}
<div class="dashboard-container">
    <header class="dashboard-header">
        <h1>Inventory Management Dashboard</h1>
    </header>

    <main class="dashboard-content">
        <section class="chart-section">
            <div class="chart-card">
                <h2>Sales by Category</h2>
                <div id="categorySalesChart" class="chart"></div>
            </div>

            <div class="chart-card">
                <h2>Stock Value by Store</h2>
                <div id="storeStockValueChart" class="chart"></div>
            </div>

            <div class="chart-card">
                <h2>Top Selling Products by Value</h2>
                <div id="topProductsChart" class="chart"></div>
            </div>

            <!-- New Charts -->
            <div class="chart-card">
                <h2>Monthly Sales Trend</h2>
                <div id="monthlySalesChart" class="chart"></div>
            </div>

            <div class="chart-card">
                <h2>Product Category Distribution</h2>
                <div id="categoryDistributionChart" class="chart"></div>
            </div>

            <div class="chart-card">
                <h2>Sales Growth Rate</h2>
                <div id="salesGrowthChart" class="chart"></div>
            </div>
        </section>
    </main>

    <footer class="dashboard-footer">
        <p>Â© 2025 Inventory Dashboard. All rights reserved.</p>
    </footer>
</div>

<!-- JSON Data -->
{{ category_sales|json_script:"category-sales-data" }}
{{ store_stock_value|json_script:"store-stock-data" }}
{{ top_products|json_script:"top-products-data" }}
{{ monthly_sales|json_script:"monthly-sales-data" }}
{{ category_distribution|json_script:"category-distribution-data" }}
{{ sales_growth|json_script:"sales-growth-data" }}

<script>
    function parseJSONData(id) {
        const element = document.getElementById(id);
        return element ? JSON.parse(element.textContent) : [];
    }

    const monthlySales = parseJSONData("monthly-sales-data");
    const categoryDistribution = parseJSONData("category-distribution-data");
    const salesGrowth = parseJSONData("sales-growth-data");

    // Monthly Sales Trend - Line Chart
    var monthlySalesOptions = {
        chart: { type: 'line', height: 300 },
        series: [{
            name: 'Total Sales',
            data: monthlySales.map(item => item.total_sales)
        }],
        xaxis: {
            categories: monthlySales.map(item => new Date(item.month).toLocaleString('default', { month: 'short', year: 'numeric' })),
        },
        colors: ['#28a745'],
    };
    new ApexCharts(document.querySelector("#monthlySalesChart"), monthlySalesOptions).render();

    // Product Category Distribution - Radar Chart
    var categoryDistributionOptions = {
        chart: { type: 'radar', height: 300 },
        series: [{
            name: 'Products',
            data: categoryDistribution.map(item => item.count)
        }],
        labels: categoryDistribution.map(item => item.category__name),
        colors: ['#ffc107'],
    };
    new ApexCharts(document.querySelector("#categoryDistributionChart"), categoryDistributionOptions).render();

    // Sales Growth Rate - Bar Chart
    var salesGrowthOptions = {
        chart: { type: 'bar', height: 300 },
        series: [{
            name: 'Growth Rate (%)',
            data: salesGrowth.map(item => item.growth_rate)
        }],
        xaxis: {
            categories: salesGrowth.map(item => item.month),
        },
        colors: ['#dc3545'],
    };
    new ApexCharts(document.querySelector("#salesGrowthChart"), salesGrowthOptions).render();
</script>

{% endblock %}
